# Deploying to Vercel

You can deploy this project to **Vercel** so that:

- The **six downloader pages** are served as **static HTML** (from `public/`).
- The **download API** runs as a **serverless function** at `/api/download` (no full Django process).

## How it works

- **Vercel is serverless** — it does not run a long-lived Django app. Only the API logic (Cobalt call) runs as a Python serverless function.
- **Pages** are pre-rendered HTML. They are generated by Django templates and exported to `public/` (see below). Forms on those pages POST to `/api/download` on the same domain.
- **Django admin, migrations, and the full app** do not run on Vercel. Use a VPS (see [DEPLOYMENT.md](DEPLOYMENT.md)) if you need the full Django stack.

## What you get on Vercel

| URL | Served as |
|-----|-----------|
| `/`, `/all-in-one`, `/all-in-one/` | `public/index.html` |
| `/tiktok`, `/tiktok/` | `public/tiktok.html` |
| `/facebook`, `/facebook/` | `public/facebook.html` |
| `/instagram`, `/instagram/` | `public/instagram.html` |
| `/youtube`, `/youtube/` | `public/youtube.html` |
| `/youtube-mp3`, `/youtube-mp3/` | `public/youtube-mp3.html` |
| `/api/download` (POST) | Serverless function `api/download.py` |

## Deploy steps

### 1. Export static pages (optional; can be done in build)

If you want to commit the static HTML so Vercel doesn’t need to run Django during build:

```bash
python manage.py export_vercel_pages
```

This writes/updates `public/*.html` with `api_url = '/api/download'`.

### 2. Deploy to Vercel

- Push the project to GitHub (or connect your repo in Vercel).
- In the Vercel dashboard: **Import** the repo.
- **Root Directory:** leave as the project root.
- **Framework Preset:** Other (or leave default).
- **Build Command:** `python manage.py export_vercel_pages` (so `public/` is regenerated on each deploy; optional if you commit `public/`).
- **Output Directory:** `public`.
- **Install Command:** `pip install -r requirements.txt` (Vercel usually detects this for Python).

Add environment variables in **Project → Settings → Environment Variables**:

- `COBALT_API_URL` (optional) — your Cobalt instance; default is the public API.

Redeploy after saving.

### 3. Timeout

The serverless function is set to **60 seconds** in `vercel.json` (`maxDuration: 60`). On the **Hobby** plan the limit is 10s; for long Cobalt runs you may need the **Pro** plan or a shorter timeout.

## Limitations on Vercel

- **No Django admin** — the full Django app is not running. Use a VPS if you need admin/SSO.
- **No database** — the project doesn’t use a DB for the download flow; this is unchanged.
- **Cold starts** — the first request to `/api/download` after idle may be slower.
- **Execution timeout** — 10s (Hobby) or 60s (Pro). Cobalt can be slow; ensure your plan allows it.

## If you need the full Django app

Use a **VPS** (e.g. UlaHost) and follow [DEPLOYMENT.md](DEPLOYMENT.md) to run Django with Gunicorn + Nginx. That gives you admin, custom middleware, and no serverless limits.
